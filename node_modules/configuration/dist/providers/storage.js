/* IMPORT */
import { DEFAULTS } from '../config.js';
import PathProp from '../utils/pp.js';
import ProviderMemory from './memory.js';
/* MAIN */
class ProviderStorage extends ProviderMemory {
    /* CONSTRUCTOR */
    constructor(options) {
        super(options);
        if (!options.storage)
            throw new Error('You need to pass a storage instance');
        this.id = options?.id ?? DEFAULTS.id;
        this.storage = options.storage;
        this.init();
    }
    /* API */
    readSync() {
        if (!this.storage)
            return super.readSync();
        const dataRaw = this.storage.getItem(this.id) ?? this.defaultsRaw;
        const data = PathProp.unflat(this.dataParser.parse(dataRaw) ?? this.defaults);
        return { data, dataRaw };
    }
    writeSync(data, force = false) {
        if (!this.storage)
            return super.writeSync(data, force);
        if (!force && this.isEqual(data))
            return;
        super.writeSync(data, true);
        try {
            this.storage.setItem(this.id, this.dataRaw);
        }
        catch { }
    }
}
/* EXPORT */
export default ProviderStorage;
